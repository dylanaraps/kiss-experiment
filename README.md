# KISS The alternative packaging system
--------
This is a packaging system I'm experimenting with. KISS is an alternative to PKGBUILD, APKBUILD, Pkgfile etc... This repository explores a much unix-like approach.

**NOTE**: The package manager can be found [here](https://github.com/kissx/kiss)

Each package is split into multiple files.

```sh
zlib/            # Package name.
├─ build         # Build script.
├─ depends       # Dependencies (one per line) (sometimes optional).
├─ sources       # Sources (one per line).
├─ version       # Package version.
┘

# Files generated by the package manager.
├─ manifest      # The built package's files and directories.
├─ checksums     # The checksums for the source files.
┘

# Optional files.
├─ post_install  # Script to run after package installation.
├─ patches/*     # Directory to store patches.
├─ files/*       # Directory to misc files.
┘
```
--------
When a package is installed, the directory is copied to `/var/db/kiss` where it becomes a database entry. Listing each dependency for packages is as simple as printing the contents of the `depends` file, searching for the package that owns a file is simple as checking each `manifest` file.

This new structure allows the package manager to be stupidly simple. POSIX sh has no arrays, however, they are mimicked by looping each line of each file. No more insecure depends="pkg pkg pkg" and for pkg in $depends.
Instead do the following:
```sh
while read-r depends; do
	# do something...
done < depends
```

This means that anyone could write a tool to manipulate the repository even the package manager! It's all in the plain text files fixed by a new line or a space.
--------

## Table of Contents
<!-- vim-markdown-toc GFM -->

* [The packaging format](#the-packaging-format)
	* [`build`](#build)
	* [`manifest`](#manifest)
	* [`sources`](#sources)
	* [`depends`](#sources)
	* [`version`](#version)
	* [`checksums`](#checksyms)
	* [`post-install`](#post-install)

<!-- vim markdown-toc -->
--------

## The package format

### `build`
The `build` tool must contain the necessary arguments to patch, configure, build, and install a package. The build script is sent one argument. This argument points to the package's directory. Everything in this directory will become part of the package's manifest and will be copied to `/` (The linux FileSystem) or `$kiss_ROOT`. The first argument is frequently used in `make DESTDIR="$1" install`.

For example:
The `build` file can be written in any programming language. The only requirment is that the file should be an executable.

```sh
./configure \
    --prefix=/usr \
    --libdir=/lib \
    --shared

make
make DESTDIR="$1" install
```
--------

### `manifest`

The `manifest` file contains the package's file and it's directory list. The full paths to the files and the directory are listed first (In reverse) order. This allow the package manager to delete directories if they're empty without the need of checks in between.

[the](the) manifest includes the package's database entry, so you can install the package with or withouw `kiss` and it will be recognized.

```
/usr/share/man/man3/zlib.3
/usr/include/zconf.h
/usr/include/zlib.h
/var/db/kiss/zlib/sources
/var/db/kiss/zlib/manifest
/var/db/kiss/zlib/checksums
/var/db/kiss/zlib/build
/var/db/kiss/zlib/version
/lib/libz.so.1.2.11
/lib/libz.so.1
/lib/libz.so
/lib/libz.a
/lib/pkgconfig/zlib.pc
/var/db/kiss/zlib
/var/db/kiss
/var/db
/var
/usr/share/man/man3
/usr/share/man
/usr/share
/usr/include
/usr
/lib/pkgconfig
/lib
```
--------

### `sources`
The `sources` file contains the package's sources on each line. Sources can be local or remote.

An optional destination field can be added to tell the package manager where to extract the source. This is relative to the regular extraction directory. The passed directories are also created.

```
https://www.openssl.org/source/openssl-X.X.X.tar.gz
patches/fix-musl.patch
https://www.openssl.org/source/openssl-X.X.X.tar.gz lib/example/
```
--------

### `depends`

The `depends` file contains the package's dependencies on each line.

```
zlib
openssl
binutils
```
--------

### `version`

The `version` file contains the package's version and the release number. The format of this file is `version release`. The release portion allows a package upgrade without the modification of the version number.

The version can also be `git 1` to specify that the package is built from the latest `git` HEAD.

```
1.2.11 1
```
--------

### `checksums`

The `checksums` file contains the `sha256` sums of each entry in the `sources` file. This is generated and verified automatically.

```
c3e5e9fdd5004dcb542feda5ee4f0ff0744628baf8ed2dd5d66f8ca1197cb1a1  zlib-1.2.11.tar.gz
```
--------

### `post-install`

The `post-install` file should contain any steps required directly after the package is installed. This includes updating fonts, databass, and creating any post-install symbolic links which may be required.

